!function(e){"use strict";function t(t){this.outerTracker.setTracking(!0);var i=new e.Point(t.position.x-t.delta.x,t.position.y-t.delta.y);i=this.viewer.viewport.pointFromPixel(i,!0);var n=this.viewer.viewport.deltaPointsFromPixels(t.delta,!0);if(this.rect)if(this.rectDone){var r=this.getAngleFromCenter(i);n=this.viewer.viewport.pointFromPixel(t.position,!0);var o=this.getAngleFromCenter(n);this.rect.rotation=(this.rect.rotation+r-o)%Math.PI}else this.rect.width+=n.x,this.rect.height+=n.y;else this.rect=new e.SelectionRect(i.x,i.y,n.x,n.y),this.rectDone=!1;return this.draw(),!0}function i(){return this.rectDone=!0,!0}function n(t){e.addClass(this.element,"dragging");var i=this.viewer.viewport.deltaPointsFromPixels(t.delta,!0);return this.rect.x+=i.x,this.rect.y+=i.y,this.draw(),!0}function r(){return e.removeClass(this.element,"dragging"),!0}function o(e){var t=e.keyCode?e.keyCode:e.charCode;return 13===t&&this.rect?(console.log(s(this.rect)),this.viewer.raiseEvent("selection",s(this.rect)),this.undraw()):String.fromCharCode(t)===this.keyboardShortcut&&this.toggleState(),!0}function s(e){var t=e.clone();return t.width<0&&(t.x+=t.width,t.width*=-1),t.height<0&&(t.y+=t.height,t.height*=-1),t}if(!e.version||e.version.major<2)throw new Error("This version of OpenSeadragonSelection requires OpenSeadragon version 2.0.0+");e.Viewer.prototype.selection=function(t){return(!this.selectionInstance||t)&&(t=t||{},t.viewer=this,this.selectionInstance=new e.Selection(t)),this.selectionInstance},e.Selection=function(s){e.extend(!0,this,{viewer:null,element:null,showSelectionControl:!0,keyboardShortcut:"c",onSelection:function(){},isSelecting:!1,rect:null,rectDone:!0},s),this.element||(this.element=e.makeNeutralElement("div"),this.element.style.background="#000"),this.overlay||(this.overlay=new e.SelectionOverlay(this.element,this.rect||new e.SelectionRect)),this.outerTracker=new e.MouseTracker({element:this.viewer.drawer.canvas,dragHandler:e.delegate(this,t),dragEndHandler:e.delegate(this,i),keyHandler:e.delegate(this,o),startDisabled:!this.isSelecting,clickHandler:function(){console.log("turtle")}}),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,n),dragEndHandler:e.delegate(this,r),keyHandler:e.delegate(this,o),scrollHandler:e.delegate(this.viewer,this.viewer.innerTracker.scrollHandler),pinchHandler:e.delegate(this.viewer,this.viewer.innerTracker.pinchHandler)}),this.keyboardShortcut&&e.addEvent(this.viewer.container,"keypress",e.delegate(this,o),!1),this.showSelectionControl,this.viewer.addHandler("selection",this.onSelection)},e.Selection.prototype={toggleState:function(){e.console.log("onSelectionToggle"),this.isSelecting?this.disable():this.enable()},enable:function(){this.isSelecting=!0,this.outerTracker.setTracking(!0),this.undraw()},disable:function(){this.isSelecting=!1,this.outerTracker.setTracking(!1),this.undraw()},draw:function(){this.overlay.update(s(this.rect)),this.overlay.drawHTML(this.viewer.container,this.viewer.viewport)},undraw:function(){this.overlay.destroy(),this.rect=null},getAngleFromCenter:function(e){var t=e.minus(this.rect.getCenter());return Math.atan2(t.x,t.y)}}}(OpenSeadragon),function(e){"use strict";e.SelectionOverlay=function(t,i){e.Overlay.apply(this,arguments),e.isPlainObject(t)?this.rotation=t.location.rotation||0:this.rotation=i.rotation||0},e.SelectionOverlay.prototype=e.extend(Object.create(e.Overlay.prototype),{drawHTML:function(){e.Overlay.prototype.drawHTML.apply(this,arguments),this.style.transform=this.style.transform.replace(/ ?rotate\(.+rad\)/,"")+" rotate("+this.rotation+"rad)"},update:function(t){e.Overlay.prototype.update.apply(this,arguments),this.rotation=t.rotation||0}})}(OpenSeadragon),function(e){"use strict";e.SelectionRect=function(t,i,n,r,o){e.Rect.apply(this,[t,i,n,r]),this.rotation=o||0},e.SelectionRect.prototype=e.extend(Object.create(e.Rect.prototype),{clone:function(){return new e.SelectionRect(this.x,this.y,this.width,this.height,this.rotation)},equals:function(t){return e.Rect.prototype.equals.apply(this,[t])&&this.rotation===t.rotation},toString:function(){return"["+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+","+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+"@"+Math.round(100*this.rotation)/100+"]"},getDegreeRotation:function(){return this.rotation*(180/Math.PI)}})}(OpenSeadragon);
//# sourceMappingURL=openseadragonselection.js.map

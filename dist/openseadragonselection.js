!function(e){"use strict";function t(t){var i=new e.Point(t.position.x-t.delta.x,t.position.y-t.delta.y);i=this.viewer.viewport.pointFromPixel(i,!0);var n=this.viewer.viewport.deltaPointsFromPixels(t.delta,!0);if(this.rect)if(this.rectDone){var s=this.rect.getAngleFromCenter(i);n=this.viewer.viewport.pointFromPixel(t.position,!0);var r=this.rect.getAngleFromCenter(n);this.rect.rotation=(this.rect.rotation+s-r)%Math.PI}else this.rect.width+=n.x,this.rect.height+=n.y;else this.rect=new e.SelectionRect(i.x,i.y,n.x,n.y),this.rectDone=!1;this.draw()}function i(){this.rectDone=!0}function n(){this.viewer.canvas.focus()}function s(t){e.addClass(this.element,"dragging");var i=this.viewer.viewport.deltaPointsFromPixels(t.delta,!0);this.rect.x+=i.x,this.rect.y+=i.y,this.draw()}function r(){e.removeClass(this.element,"dragging")}function o(t,i){var n=i.delta,s=this.rect.getDegreeRotation();0!==s&&(n=n.rotate(-1*s,new e.Point(0,0))),n=this.viewer.viewport.deltaPointsFromPixels(n,!0);var r=this.rect.getCenter();switch(t){case 0:this.rect.y+=n.y,this.rect.height-=n.y;break;case 1:this.rect.width+=n.x;break;case 2:this.rect.height+=n.y;break;case 3:this.rect.x+=n.x,this.rect.width-=n.x}if(0!==s){var o=this.rect.getCenter(),h=o.rotate(s,r);n=h.minus(o),this.rect.x+=n.x,this.rect.y+=n.y}this.draw()}function h(e){var t=e.keyCode?e.keyCode:e.charCode;13===t?this.confirm():String.fromCharCode(t)===this.keyboardShortcut&&this.toggleState()}if(!e.version||e.version.major<2)throw new Error("This version of OpenSeadragonSelection requires OpenSeadragon version 2.0.0+");e.Viewer.prototype.selection=function(t){return(!this.selectionInstance||t)&&(t=t||{},t.viewer=this,this.selectionInstance=new e.Selection(t)),this.selectionInstance},e.Selection=function(l){e.extend(!0,this,{viewer:null,isSelecting:!1,rectDone:!!l.rect,element:null,toggleButton:null,showSelectionControl:!0,showConfirmDenyButtons:!0,styleConfirmDenyButtons:!0,keyboardShortcut:"c",rect:null,onSelection:function(){}},l),this.navImages=this.navImages||{selection:{REST:"selection_rest.png",GROUP:"selection_grouphover.png",HOVER:"selection_hover.png",DOWN:"selection_pressed.png"},selectionConfirm:{REST:"selection_confirm_rest.png",GROUP:"selection_confirm_grouphover.png",HOVER:"selection_confirm_hover.png",DOWN:"selection_confirm_pressed.png"},selectionCancel:{REST:"selection_cancel_rest.png",GROUP:"selection_cancel_grouphover.png",HOVER:"selection_cancel_hover.png",DOWN:"selection_cancel_pressed.png"}},e.extend(!0,this.navImages,this.viewer.navImages),this.element||(this.element=e.makeNeutralElement("div"),this.element.style.background="rgba(0, 0, 0, 0.1)"),this.borders=this.borders||[];for(var a,c=0;4>c;c++)this.borders[c]||(this.borders[c]=e.makeNeutralElement("div"),this.borders[c].className="border-"+c,this.borders[c].style.position="absolute",this.borders[c].style.width="1px",this.borders[c].style.height="1px",this.borders[c].style.background="#fff"),a=e.makeNeutralElement("div"),a.className="border-"+c+"-handle",a.style.position="absolute",a.style.top="50%",a.style.left="50%",a.style.width="6px",a.style.height="6px",a.style.margin="-4px 0 0 -4px",a.style.background="#000",a.style.border="1px solid #ccc",new e.MouseTracker({element:this.borders[c],dragHandler:o.bind(this,c)}),this.borders[c].appendChild(a),this.element.appendChild(this.borders[c]);this.borders[0].style.top=0,this.borders[0].style.width="100%",this.borders[1].style.right=0,this.borders[1].style.height="100%",this.borders[2].style.bottom=0,this.borders[2].style.width="100%",this.borders[3].style.left=0,this.borders[3].style.height="100%",this.overlay||(this.overlay=new e.SelectionOverlay(this.element,this.rect||new e.SelectionRect)),this.innerTracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,dragHandler:e.delegate(this,s),dragEndHandler:e.delegate(this,r),clickHandler:e.delegate(this,n),scrollHandler:e.delegate(this.viewer,this.viewer.innerTracker.scrollHandler),pinchHandler:e.delegate(this.viewer,this.viewer.innerTracker.pinchHandler)}),this.outerTracker=new e.MouseTracker({element:this.viewer.canvas,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,dragHandler:e.delegate(this,t),dragEndHandler:e.delegate(this,i),clickHandler:e.delegate(this,n),startDisabled:!this.isSelecting}),this.keyboardShortcut&&e.addEvent(this.viewer.container,"keypress",e.delegate(this,h),!1);var d=this.viewer.prefixUrl||"",u=this.viewer.buttons&&this.viewer.buttons.buttons,g=u?this.viewer.buttons.buttons[0]:null,v=g?g.onFocus:null,p=g?g.onBlur:null;if(this.showSelectionControl&&(this.toggleButton=new e.Button({element:this.toggleButton?e.getElement(this.toggleButton):null,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,tooltip:e.getString("Tooltips.SelectionToggle")||"Toggle selection",srcRest:d+this.navImages.selection.REST,srcGroup:d+this.navImages.selection.GROUP,srcHover:d+this.navImages.selection.HOVER,srcDown:d+this.navImages.selection.DOWN,onRelease:this.toggleState.bind(this),onFocus:v,onBlur:p}),u&&(this.viewer.buttons.buttons.push(this.toggleButton),this.viewer.buttons.element.appendChild(this.toggleButton.element))),this.showConfirmDenyButtons){this.confirmButton=new e.Button({element:this.confirmButton?e.getElement(this.confirmButton):null,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,tooltip:e.getString("Tooltips.SelectionConfirm")||"Confirm selection",srcRest:d+this.navImages.selectionConfirm.REST,srcGroup:d+this.navImages.selectionConfirm.GROUP,srcHover:d+this.navImages.selectionConfirm.HOVER,srcDown:d+this.navImages.selectionConfirm.DOWN,onRelease:this.confirm.bind(this),onFocus:v,onBlur:p});var w=this.confirmButton.element;this.element.appendChild(w),this.cancelButton=new e.Button({element:this.cancelButton?e.getElement(this.cancelButton):null,clickTimeThreshold:this.viewer.clickTimeThreshold,clickDistThreshold:this.viewer.clickDistThreshold,tooltip:e.getString("Tooltips.SelectionConfirm")||"Cancel selection",srcRest:d+this.navImages.selectionCancel.REST,srcGroup:d+this.navImages.selectionCancel.GROUP,srcHover:d+this.navImages.selectionCancel.HOVER,srcDown:d+this.navImages.selectionCancel.DOWN,onRelease:this.cancel.bind(this),onFocus:v,onBlur:p});var m=this.cancelButton.element;this.element.appendChild(m),this.styleConfirmDenyButtons&&(w.style.position="absolute",w.style.top="50%",w.style.left="50%",w.style.transform="translate(-100%, -50%)",m.style.position="absolute",m.style.top="50%",m.style.left="50%",m.style.transform="translate(0, -50%)")}this.viewer.addHandler("selection",this.onSelection),this.viewer.addHandler("open",this.draw.bind(this)),this.viewer.addHandler("animation",this.draw.bind(this)),this.viewer.addHandler("resize",this.draw.bind(this)),this.viewer.addHandler("rotate",this.draw.bind(this))},e.extend(e.Selection.prototype,e.ControlDock.prototype,{toggleState:function(){return this.setState(!this.isSelecting)},setState:function(e){return this.isSelecting=e,this.viewer.innerTracker.setTracking(!e),this.outerTracker.setTracking(e),e?this.draw():this.undraw(),this.viewer.raiseEvent("selection_toggle",e),this},enable:function(){return this.setState(!0)},disable:function(){return this.setState(!1)},draw:function(){return this.rect&&(this.overlay.update(this.rect.normalize()),this.overlay.drawHTML(this.viewer.drawer.container,this.viewer.viewport)),this},undraw:function(){return this.overlay.destroy(),this.rect=null,this},confirm:function(){if(this.rect){var t=this.rect.normalize(),i=this.viewer.viewport.viewportToImageRectangle(t);i=e.SelectionRect.fromRect(i).round(),i.rotation=t.rotation,this.viewer.raiseEvent("selection",i),this.undraw()}return this},cancel:function(){return this.viewer.raiseEvent("selection_cancel",!1),this.undraw()}})}(OpenSeadragon),function(e){"use strict";e.SelectionOverlay=function(t,i){e.Overlay.apply(this,arguments),e.isPlainObject(t)?this.rotation=t.location.rotation||0:this.rotation=i.rotation||0},e.SelectionOverlay.prototype=e.extend(Object.create(e.Overlay.prototype),{drawHTML:function(){e.Overlay.prototype.drawHTML.apply(this,arguments),this.style.transform=this.style.transform.replace(/ ?rotate\(.+rad\)/,"")+" rotate("+this.rotation+"rad)"},update:function(t){e.Overlay.prototype.update.apply(this,arguments),this.rotation=t.rotation||0}})}(OpenSeadragon),function(e){"use strict";e.SelectionRect=function(t,i,n,s,r){e.Rect.apply(this,[t,i,n,s]),this.rotation=r||0},e.SelectionRect.fromRect=function(t){return new e.SelectionRect(t.x,t.y,t.width,t.height)},e.SelectionRect.prototype=e.extend(Object.create(e.Rect.prototype),{clone:function(){return new e.SelectionRect(this.x,this.y,this.width,this.height,this.rotation)},equals:function(t){return e.Rect.prototype.equals.apply(this,[t])&&this.rotation===t.rotation},toString:function(){return"["+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+","+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+"@"+Math.round(100*this.rotation)/100+"]"},swapWidthHeight:function(){var e=this.clone();return e.width=this.height,e.height=this.width,e},getDegreeRotation:function(){return this.rotation*(180/Math.PI)},getAngleFromCenter:function(e){var t=e.minus(this.getCenter());return Math.atan2(t.x,t.y)},round:function(){return new e.SelectionRect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height),this.rotation)},normalize:function(){var e=this.clone();return e.width<0&&(e.x+=e.width,e.width*=-1),e.height<0&&(e.y+=e.height,e.height*=-1),e.rotation%=Math.PI,e},reduceRotation:function(){var e;return this.rotation<Math.PI/-4?(e=this.swapWidthHeight(),e.rotation+=Math.PI/2):this.rotation>Math.PI/4?(e=this.swapWidthHeight(),e.rotation-=Math.PI/2):e=this.clone(),e}})}(OpenSeadragon);
//# sourceMappingURL=openseadragonselection.js.map

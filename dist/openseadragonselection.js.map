{"version":3,"sources":["selection.js","selectionoverlay.js","selectionrect.js"],"names":["$","onOutsideDrag","e","end","this","viewer","viewport","deltaPointsFromPixels","delta","rect","startNew","start","Point","position","x","y","pointFromPixel","SelectionRect","addOverlay","element","fixRect","width","height","updateOverlay","onOutsideDragEnd","onInsideDrag","className","indexOf","onInsideDragEnd","replace","onKeyPress","key","keyCode","charCode","raiseEvent","removeOverlay","String","fromCharCode","keyboardShortcut","toggleState","fixed","Rect","version","major","Error","Viewer","prototype","selection","options","selectionInstance","refresh","Selection","extend","showSelectionControl","onSelection","isSelecting","makeNeutralElement","style","background","outerTracker","MouseTracker","drawer","canvas","dragHandler","delegate","dragEndHandler","keyHandler","startDisabled","innerTracker","addEvent","container","addHandler","console","log","disable","enable","setTracking","OpenSeadragon","SelectionOverlay","Overlay","apply","arguments","drawHTML","rotation","clone","equals","other","toString","Math","round"],"mappings":"CAkCA,SAAAA,GACA,YAiHA,SAAAC,GAAAC,GACA,GAAAC,GAAAC,KAAAC,OAAAC,SAAAC,sBAAAL,EAAAM,OAAA,EACA,KAAAJ,KAAAK,MAAAL,KAAAM,SAAA,CACAN,KAAAM,UAAA,CACA,IAAAC,GAAA,GAAAX,GAAAY,MAAAV,EAAAW,SAAAC,EAAAZ,EAAAM,MAAAM,EAAAZ,EAAAW,SAAAE,EAAAb,EAAAM,MAAAO,EACAJ,GAAAP,KAAAC,OAAAC,SAAAU,eAAAL,GAAA,GACAP,KAAAK,KAAA,GAAAT,GAAAiB,cAAAN,EAAAG,EAAAH,EAAAI,EAAAZ,EAAAW,EAAAX,EAAAY,GACAX,KAAAC,OAAAa,WAAAd,KAAAe,QAAAC,EAAAhB,KAAAK,WAEAL,MAAAK,KAAAY,OAAAlB,EAAAW,EACAV,KAAAK,KAAAa,QAAAnB,EAAAY,EACAX,KAAAC,OAAAkB,cAAAnB,KAAAe,QAAAC,EAAAhB,KAAAK,OAIA,QAAAe,KACApB,KAAAM,UAAA,EAGA,QAAAe,GAAAvB,GACA,KAAAE,KAAAe,QAAAO,UAAAC,QAAA,gBACAvB,KAAAe,QAAAO,WAAA,aAEA,IAAAlB,GAAAJ,KAAAC,OAAAC,SAAAC,sBAAAL,EAAAM,OAAA,EACAJ,MAAAK,KAAAK,GAAAN,EAAAM,EACAV,KAAAK,KAAAM,GAAAP,EAAAO,EACAX,KAAAC,OAAAkB,cAAAnB,KAAAe,QAAAC,EAAAhB,KAAAK,OAGA,QAAAmB,KACAxB,KAAAe,QAAAO,UAAAtB,KAAAe,QAAAO,UAAAG,QAAA,aAAA,IAGA,QAAAC,GAAA5B,GACA,GAAA6B,GAAA7B,EAAA8B,QAAA9B,EAAA8B,QAAA9B,EAAA+B,QACA,MAAAF,GACA3B,KAAAC,OAAA6B,WAAA,YAAAd,EAAAhB,KAAAK,OACAL,KAAAC,OAAA8B,cAAA/B,KAAAe,UACAiB,OAAAC,aAAAN,KAAA3B,KAAAkC,kBACAlC,KAAAmC,cAIA,QAAAnB,GAAAX,GACA,GAAA+B,GAAA,GAAAxC,GAAAyC,KAAAhC,EAAAK,EAAAL,EAAAM,EAAAN,EAAAY,MAAAZ,EAAAa,OASA,OARAkB,GAAAnB,MAAA,IACAmB,EAAA1B,GAAA0B,EAAAnB,MACAmB,EAAAnB,OAAA,IAEAmB,EAAAlB,OAAA,IACAkB,EAAAzB,GAAAyB,EAAAlB,OACAkB,EAAAlB,QAAA,IAEAkB,EApKA,IAAAxC,EAAA0C,SAAA1C,EAAA0C,QAAAC,MAAA,EACA,KAAA,IAAAC,OAAA,+EAGA5C,GAAA6C,OAAAC,UAAAC,UAAA,SAAAC,GACA5C,KAAA6C,kBAKA7C,KAAA6C,kBAAAC,QAAAF,IAJAA,EAAAA,MACAA,EAAA3C,OAAAD,KACAA,KAAA6C,kBAAA,GAAAjD,GAAAmD,UAAAH,KAaAhD,EAAAmD,UAAA,SAAAH,GAEAhD,EAAAoD,QAAA,EAAAhD,MAEAC,OAAA,KACAc,QAAA,KACAkC,sBAAA,EACAf,iBAAA,IACAgB,YAAA,aAEAC,aAAA,EACA9C,KAAA,KACAC,UAAA,GACAsC,GAEA5C,KAAAe,UACAf,KAAAe,QAAAnB,EAAAwD,mBAAA,OACApD,KAAAe,QAAAsC,MAAAC,WAAA,QAGAtD,KAAAuD,aAAA,GAAA3D,GAAA4D,cACAzC,QAAAf,KAAAC,OAAAwD,OAAAC,OACAC,YAAA/D,EAAAgE,SAAA5D,KAAAH,GACAgE,eAAAjE,EAAAgE,SAAA5D,KAAAoB,GACA0C,WAAAlE,EAAAgE,SAAA5D,KAAA0B,GACAqC,eAAA/D,KAAAmD,cAGAnD,KAAAgE,aAAA,GAAApE,GAAA4D,cACAzC,QAAAf,KAAAe,QACA4C,YAAA/D,EAAAgE,SAAA5D,KAAAqB,GACAwC,eAAAjE,EAAAgE,SAAA5D,KAAAwB,KAIAxB,KAAAkC,kBAEAtC,EAAAqE,SACAjE,KAAAC,OAAAiE,UACA,WACAtE,EAAAgE,SAAA5D,KAAA0B,IACA,GAGA1B,KAAAiD,qBAiBAjD,KAAAC,OAAAkE,WAAA,YAAAnE,KAAAkD,cAGAtD,EAAAmD,UAAAL,WAEAP,YAAA,WACAvC,EAAAwE,QAAAC,IAAA,qBACArE,KAAAmD,YACAnD,KAAAsE,UAEAtE,KAAAuE,UAIAA,OAAA,WACAvE,KAAAmD,aAAA,EACAnD,KAAAuD,aAAAiB,aAAA,GACAxE,KAAAC,OAAA8B,cAAA/B,KAAAe,SACAf,KAAAK,KAAA,MAGAiE,QAAA,WACAtE,KAAAmD,aAAA,EACAnD,KAAAuD,aAAAiB,aAAA,GACAxE,KAAAC,OAAA8B,cAAA/B,KAAAe,SACAf,KAAAK,KAAA,QA4DAoE,eC5MA,SAAA7E,GACA,YAuBAA,GAAA8E,iBAAA,WACA9E,EAAA+E,QAAAC,MAAA5E,KAAA6E,YAGAjF,EAAAoD,OAAApD,EAAA8E,iBAAAhC,UAAA9C,EAAA+E,QAAAjC,WAMAoC,SAAA,WACAlF,EAAA+E,QAAAjC,UAAAoC,SAAAF,MAAA5E,KAAA6E,WACA7E,KAAAqD,MAAAC,WAAA,UAIAmB,eCxCA,SAAA7E,GACA,YAeAA,GAAAiB,cAAA,SAAAH,EAAAC,EAAAM,EAAAC,EAAA6D,GACAnF,EAAAyC,KAAAuC,MAAA5E,MAAAU,EAAAC,EAAAM,EAAAC,IAOAlB,KAAA+E,SAAAA,GAAA,GAGAnF,EAAAoD,OAAApD,EAAAiB,cAAA6B,UAAA9C,EAAAyC,KAAAK,WAMAsC,MAAA,WACA,MAAA,IAAApF,GAAAiB,cAAAb,KAAAU,EAAAV,KAAAW,EAAAX,KAAAiB,MAAAjB,KAAAkB,OAAAlB,KAAA+E,WASAE,OAAA,SAAAC,GACA,MAAAtF,GAAAyC,KAAAK,UAAAuC,OAAAL,MAAA5E,MAAAkF,KACAlF,KAAA+E,WAAAG,EAAAH,UASAI,SAAA,WACA,MAAA,IACAC,KAAAC,MAAA,IAAArF,KAAAU,GAAA,IAAA,IACA0E,KAAAC,MAAA,IAAArF,KAAAW,GAAA,IAAA,IACAyE,KAAAC,MAAA,IAAArF,KAAAiB,OAAA,IAAA,IACAmE,KAAAC,MAAA,IAAArF,KAAAkB,QAAA,IAAA,IACAkE,KAAAC,MAAA,IAAArF,KAAA+E,UAAA,IACA,QAIAN","file":"openseadragonselection.js","sourcesContent":["/*\n * OpenSeadragon - full-screen support functions\n *\n * Copyright (C) 2009 CodePlex Foundation\n * Copyright (C) 2010-2013 OpenSeadragon contributors\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n * - Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n *\n * - Redistributions in binary form must reproduce the above copyright\n *   notice, this list of conditions and the following disclaimer in the\n *   documentation and/or other materials provided with the distribution.\n *\n * - Neither the name of CodePlex Foundation nor the names of its\n *   contributors may be used to endorse or promote products derived from\n *   this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED\n * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\n * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n(function( $ ) {\n    'use strict';\n\n    if (!$.version || $.version.major < 2) {\n        throw new Error('This version of OpenSeadragonSelection requires OpenSeadragon version 2.0.0+');\n    }\n\n    $.Viewer.prototype.selection = function(options) {\n        if (!this.selectionInstance) {\n            options = options || {};\n            options.viewer = this;\n            this.selectionInstance = new $.Selection(options);\n        } else {\n            this.selectionInstance.refresh(options);\n        }\n    };\n\n\n    /**\n    * @class Selection\n    * @classdesc Provides functionality for selecting part of an image\n    * @memberof OpenSeadragon\n    * @param {Object} options\n    */\n    $.Selection = function ( options ) {\n\n        $.extend( true, this, {\n            //internal state properties\n            viewer:               null,\n            element:              null,\n            showSelectionControl: true,\n            keyboardShortcut:     'c',\n            onSelection:          function() {},\n\n            isSelecting:          false,\n            rect:                 null,\n            startNew:             true\n        }, options );\n\n        if (!this.element) {\n            this.element = $.makeNeutralElement( 'div' );\n            this.element.style.background = '#000';\n        }\n\n        this.outerTracker = new $.MouseTracker({\n            element:                  this.viewer.drawer.canvas,\n            dragHandler:              $.delegate( this, onOutsideDrag ),\n            dragEndHandler:           $.delegate( this, onOutsideDragEnd ),\n            keyHandler:               $.delegate( this, onKeyPress ),\n            startDisabled:            !this.isSelecting,\n        });\n\n        this.innerTracker = new $.MouseTracker({\n            element:                  this.element,\n            dragHandler:              $.delegate( this, onInsideDrag ),\n            dragEndHandler:           $.delegate( this, onInsideDragEnd ),\n            // keyHandler:               $.delegate( this, onKeyPress ),\n        });\n\n        if ( this.keyboardShortcut ) {\n            // var cb = this.viewer.innerTracker\n            $.addEvent(\n                this.viewer.container,\n                'keypress',\n                $.delegate( this, onKeyPress ),\n                false\n            );\n        }\n        if ( this.showSelectionControl ) {\n            // @TODO\n            // this.viewer.buttons.push( this.selectionButton = new $.Button({\n            //     element:    null,\n            //     clickTimeThreshold: this.viewer.clickTimeThreshold,\n            //     clickDistThreshold: this.viewer.clickDistThreshold,\n            //     tooltip:    $.getString( \"Tooltips.RotateRight\" ),\n            //     srcRest:    resolveUrl( this.viewer.prefixUrl, this.viewer.navImages.rotateright.REST ),\n            //     srcGroup:   resolveUrl( this.viewer.prefixUrl, this.viewer.navImages.rotateright.GROUP ),\n            //     srcHover:   resolveUrl( this.viewer.prefixUrl, this.viewer.navImages.rotateright.HOVER ),\n            //     srcDown:    resolveUrl( this.viewer.prefixUrl, this.viewer.navImages.rotateright.DOWN ),\n            //     onRelease:  this.toggleState.bind( this ),\n            //     onFocus:    $.delegate( this.viewer, onFocus ),\n            //     onBlur:     $.delegate( this.viewer, onBlur )\n            // }));\n        }\n\n        this.viewer.addHandler('selection', this.onSelection);\n    };\n\n    $.Selection.prototype = /** @lends OpenSeadragon.Selection.prototype */{\n\n        toggleState: function() {\n            $.console.log('onSelectionToggle');\n            if (this.isSelecting) {\n                this.disable();\n            } else {\n                this.enable();\n            }\n        },\n\n        enable: function() {\n            this.isSelecting = true;\n            this.outerTracker.setTracking(true);\n            this.viewer.removeOverlay(this.element);\n            this.rect = null;\n        },\n\n        disable: function() {\n            this.isSelecting = false;\n            this.outerTracker.setTracking(false);\n            this.viewer.removeOverlay(this.element);\n            this.rect = null;\n        }\n    };\n\n    function onOutsideDrag(e) {\n        var end = this.viewer.viewport.deltaPointsFromPixels(e.delta, true);\n        if (!this.rect || this.startNew) {\n            this.startNew = false;\n            var start = new $.Point(e.position.x - e.delta.x, e.position.y - e.delta.y);\n            start = this.viewer.viewport.pointFromPixel(start, true);\n            this.rect = new $.SelectionRect(start.x, start.y, end.x, end.y);\n            this.viewer.addOverlay(this.element, fixRect(this.rect));\n        } else {\n            this.rect.width += end.x;\n            this.rect.height += end.y;\n            this.viewer.updateOverlay(this.element, fixRect(this.rect));\n        }\n    }\n\n    function onOutsideDragEnd() {\n        this.startNew = true;\n    }\n\n    function onInsideDrag(e) {\n        if (this.element.className.indexOf(' dragging ') === -1) {\n            this.element.className += ' dragging ';\n        }\n        var delta = this.viewer.viewport.deltaPointsFromPixels(e.delta, true);\n        this.rect.x += delta.x;\n        this.rect.y += delta.y;\n        this.viewer.updateOverlay(this.element, fixRect(this.rect));\n    }\n\n    function onInsideDragEnd() {\n        this.element.className = this.element.className.replace(' dragging ', '');\n    }\n\n    function onKeyPress(e) {\n        var key = e.keyCode ? e.keyCode : e.charCode;\n        if (key === 13) {\n            this.viewer.raiseEvent( 'selection', fixRect(this.rect) );\n            this.viewer.removeOverlay(this.element);\n        } else if (String.fromCharCode(key) === this.keyboardShortcut) {\n            this.toggleState();\n        }\n    }\n\n    function fixRect(rect) {\n        var fixed = new $.Rect(rect.x, rect.y, rect.width, rect.height);\n        if (fixed.width < 0) {\n            fixed.x += fixed.width;\n            fixed.width *= -1;\n        }\n        if (fixed.height < 0) {\n            fixed.y += fixed.height;\n            fixed.height *= -1;\n        }\n        return fixed;\n    }\n\n})( OpenSeadragon );\n","(function( $ ){\n    'use strict';\n\n    /**\n     * @class Overlay\n     * @classdesc Provides a way to float an HTML element on top of the viewer element.\n     *\n     * @memberof OpenSeadragon\n     * @param {Object} options\n     * @param {Element} options.element\n     * @param {OpenSeadragon.Point|OpenSeadragon.Rect} options.location - The\n     * location of the overlay on the image. If a {@link OpenSeadragon.Point}\n     * is specified, the overlay will keep a constant size independently of the\n     * zoom. If a {@link OpenSeadragon.Rect} is specified, the overlay size will\n     * be adjusted when the zoom changes.\n     * @param {OpenSeadragon.OverlayPlacement} [options.placement=OpenSeadragon.OverlayPlacement.TOP_LEFT]\n     * Relative position to the viewport.\n     * Only used if location is a {@link OpenSeadragon.Point}.\n     * @param {OpenSeadragon.Overlay.OnDrawCallback} [options.onDraw]\n     * @param {Boolean} [options.checkResize=true] Set to false to avoid to\n     * check the size of the overlay everytime it is drawn when using a\n     * {@link OpenSeadragon.Point} as options.location. It will improve\n     * performances but will cause a misalignment if the overlay size changes.\n     */\n    $.SelectionOverlay = function() {\n        $.Overlay.apply( this, arguments );\n    };\n\n    $.extend( $.SelectionOverlay.prototype, $.Overlay.prototype, /** @lends OpenSeadragon.SelectionOverlay.prototype */{\n\n        /**\n         * @function\n         * @param {Element} container\n         */\n        drawHTML: function() {\n            $.Overlay.prototype.drawHTML.apply( this, arguments );\n            this.style.background = 'red';\n        },\n    });\n\n}( OpenSeadragon ));\n","(function( $ ){\n    'use strict';\n\n    /**\n     * @class SelectionRect\n     * @classdesc A display rectangle is very similar to {@link OpenSeadragon.Rect} but adds rotation\n     * around the center point\n     *\n     * @memberof OpenSeadragon\n     * @extends OpenSeadragon.Rect\n     * @param {Number} x The vector component 'x'.\n     * @param {Number} y The vector component 'y'.\n     * @param {Number} width The vector component 'height'.\n     * @param {Number} height The vector component 'width'.\n     * @param {Number} rotation The rotation in degrees\n     */\n    $.SelectionRect = function( x, y, width, height, rotation ) {\n        $.Rect.apply( this, [ x, y, width, height ] );\n\n        /**\n         * The rotation in degrees\n         * @member {Number} rotation\n         * @memberof OpenSeadragon.SelectionRect#\n         */\n        this.rotation = rotation || 0;\n    };\n\n    $.extend( $.SelectionRect.prototype, $.Rect.prototype, /** @lends OpenSeadragon.SelectionRect.prototype */{\n\n        /**\n         * @function\n         * @returns {OpenSeadragon.Rect} a duplicate of this Rect\n         */\n        clone: function() {\n            return new $.SelectionRect(this.x, this.y, this.width, this.height, this.rotation);\n        },\n\n        /**\n         * Determines if two Rectangles have equivalent components.\n         * @function\n         * @param {OpenSeadragon.Rect} rectangle The Rectangle to compare to.\n         * @return {Boolean} 'true' if all components are equal, otherwise 'false'.\n         */\n        equals: function( other ) {\n            return $.Rect.prototype.equals.apply(this, [ other ]) &&\n                ( this.rotation === other.rotation );\n        },\n\n        /**\n         * Provides a string representation of the rectangle which is useful for\n         * debugging.\n         * @function\n         * @returns {String} A string representation of the rectangle.\n         */\n        toString: function() {\n            return '[' +\n                (Math.round(this.x*100) / 100) + ',' +\n                (Math.round(this.y*100) / 100) + ',' +\n                (Math.round(this.width*100) / 100) + 'x' +\n                (Math.round(this.height*100) / 100) + '@' +\n                (Math.round(this.rotation*100) / 100) +\n            ']';\n        }\n    });\n\n}( OpenSeadragon ));\n"],"sourceRoot":"/source/"}